# OpenShift Console 4.22 Release Notes

> [!WARNING]
> These 4.22 release notes describe features and behavior that are still in progress and
> might change before general availability.

## Changes to shared modules

Additional updates to these shared modules might occur before the 4.22 release is generally available.

- Upgraded from `react` v17 to v18. Plugins must use `react` 18 to remain compatible with Console.
- Upgraded from `react-redux` v7 to v8. Plugins must use `react-redux` v8 to remain compatible with Console.
- Upgraded from `react-i18next` v11 to v15. Plugins must use `react-i18next` v15 to remain compatible with Console.
- Added `@openshift/dynamic-plugin-sdk` to shared modules. Plugins must only use `@openshift-console/dynamic-plugin-sdk`
  to remain compatible with Console.

## Removal of `@openshift-console/plugin-shared`

The `@openshift-console/plugin-shared` package has been removed from the Console codebase, and the
corresponding npm package is deprecated. Plugins should remove this dependency from their `package.json`
if present.

## React Router

### Migration from `history` package to React Router types

Console has migrated from using the `history` package to React Router's native types ([CONSOLE-4990], [#15959]). This affects the following public API types:

- `useDeleteModal` hook's `redirectTo` parameter type has changed from `LocationDescriptor` (from `history`)
  to `To` (from `react-router-dom-v5-compat`)

#### Migration guide

If your plugin uses the `useDeleteModal` hook and passes a `redirectTo` parameter, update your imports:

```diff
- import { LocationDescriptor } from 'history';
+ import { To } from 'react-router-dom-v5-compat';

  const MyComponent = ({ resource }) => {
-   const launchDeleteModal = useDeleteModal(resource, redirectTo as LocationDescriptor);
+   const launchDeleteModal = useDeleteModal(resource, redirectTo as To);
    // ...
  };
```

The `To` type is compatible with the previous `LocationDescriptor` type (accepts strings and location
objects), so most plugins should only need to update their imports.

## React 18 upgrade tips

Console now uses React 18. The following guidance highlights common update considerations
for plugin authors.

### Upgrade guidance

When upgrading plugins to support React 18, plugin authors might need to review and update
custom hooks related to React 18's new rendering behavior. Plugins may also need to update their
code to align with new type definitions. For more information, see:

- [`@types/react` v18 changelog](https://github.com/DefinitelyTyped/DefinitelyTyped/pull/56210)
- [React 18 Upgrade Guide](https://react.dev/blog/2022/03/08/react-18-upgrade-guide)

### New JSX transform

Console currently supports React 18. The [new JSX transform] was introduced in React 17. The new JSX
transform reduces bundle size, as well as allowing the usage of JSX syntax without importing the React
namespace. Adopting the new JSX transform is highly recommended in React 18.

In `tsconfig.json`, set the `jsx` compiler option to `react-jsx`. The following diff shows a common
update required when migrating to the new JSX transform:

```diff
 {
   "compilerOptions": {
-    "jsx": "react"
+    "jsx": "react-jsx"
   }
 }
```

You may also consider running the [upgrade-react-imports] codemod to automatically update your imports to use named
imports (which is React's recommended way). The React namespace import (`import * as React from 'react'`) is still
valid and will still be supported by React 18.

[new JSX transform]: https://legacy.reactjs.org/blog/2020/09/22/introducing-the-new-jsx-transform.html
[upgrade-react-imports]: https://app.codemod.com/registry/react/update-react-imports

[CONSOLE-4990]: https://issues.redhat.com/browse/CONSOLE-4990
[#15959]: https://github.com/openshift/console/pull/15959
